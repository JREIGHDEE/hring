<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS System</title>
    <style>
        :root {
            --primary-bg: #3e4a3e;
            --secondary-bg: #677967;
            --content-bg: #EAE5D9;
            --card-bg: #FFFFFF;
            --text-dark: #333;
            --text-light: #fff;
            --accent-green: #679469;
            --accent-blue: #5a7a9c;
            --accent-red: #D96C6C;
            --border-color: #dee2e6;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        
        body { margin: 0; font-family: 'Inter', sans-serif; background-color: var(--primary-bg); color: var(--text-dark); height: 100vh; overflow: hidden; }
        .hidden { display: none !important; }

        .app-shell { display: flex; width: 100%; height: 100%; padding: 20px; box-sizing: border-box; }
        .sidebar { width: 250px; background-color: var(--secondary-bg); border-radius: 12px; padding: 20px; display: flex; flex-direction: column; color: var(--text-light); flex-shrink: 0; }
        .main-content { flex-grow: 1; background-color: var(--content-bg); margin-left: 20px; border-radius: 12px; padding: 30px; overflow-y: hidden; display: flex; flex-direction: column; }
        
        .sidebar-header { font-size: 1.5em; font-weight: bold; margin-bottom: 40px; }
        .sidebar-nav ul { list-style: none; padding: 0; margin: 0; }
        .sidebar-nav li { padding: 15px 10px; border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: background-color 0.2s; }
        .sidebar-nav li:hover { background-color: rgba(255, 255, 255, 0.1); }
        .sidebar-nav .active { background-color: var(--primary-bg); font-weight: bold; }
        .sidebar-footer { margin-top: auto; padding: 15px 10px; cursor: pointer; border-radius: 8px; }
        
        h1 { margin: 0 0 20px 0; color: var(--primary-bg); border-bottom: 2px solid var(--border-color); padding-bottom: 15px;}

        .pos-container { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; height: calc(100% - 80px); }
        
        /* Product Selection Panel */
        .product-panel { background-color: var(--card-bg); border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        .product-panel h2 { margin-top: 0; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; overflow-y: auto; padding: 5px; }
        .product-card { border: 1px solid var(--border-color); border-radius: 8px; padding: 15px; text-align: center; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 6px 15px rgba(0,0,0,0.1); }
        .product-card img { width: 80px; height: 80px; margin-bottom: 10px; object-fit: cover; background-color: #f0f0f0; border-radius: 50%;}
        .product-name { font-weight: bold; margin-bottom: 5px; }
        .product-price { color: var(--accent-green); font-weight: 500; }

        /* Current Order Panel */
        .order-panel { background-color: var(--card-bg); border-radius: 12px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        .order-panel h2 { margin-top: 0; }
        #order-items-list { flex-grow: 1; overflow-y: auto; }
        .order-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
        .order-item-details .name { font-weight: 500; }
        .order-item-details .price { font-size: 0.9em; color: #666; }
        .order-item-qty { display: flex; align-items: center; gap: 8px; }
        .qty-btn { background: none; border: 1px solid #ccc; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; }
        .order-item-subtotal { font-weight: bold; }

        .order-total-section { padding-top: 20px; border-top: 2px solid var(--text-dark); }
        .total-line { display: flex; justify-content: space-between; font-size: 1.5em; font-weight: bold; margin-bottom: 20px; }
        
        .action-btn { width: 100%; padding: 15px; border-radius: 8px; border: none; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: background-color 0.2s; color: white; }
        .payment-btn { background-color: var(--accent-green); }
        .clear-btn { background-color: var(--accent-red); margin-top: 10px; }
        .action-btn:disabled { background-color: #aaa; cursor: not-allowed; }
        
        /* Modal Styles */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
        .modal-content { background-color: #fefefe; margin: auto; padding: 30px; border: none; width: 90%; max-width: 450px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); text-align: center; }
        .modal h2 { margin-top: 0; }
        .modal .form-group { text-align: left; margin: 20px 0; }
        .modal label { font-weight: 500; margin-bottom: 8px; display: block; }
        .modal input { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; box-sizing: border-box; font-size: 1.2em; text-align: right; }
        #change-due { font-size: 1.8em; font-weight: bold; color: var(--accent-blue); margin: 20px 0; min-height: 30px; }
        .modal-actions { display: flex; gap: 15px; margin-top: 20px; }

        /* Transaction Summary Modal */
        #summary-details { text-align: left; margin: 20px 0; border-top: 1px solid #eee; padding-top: 15px; }
        #summary-details p { display: flex; justify-content: space-between; margin: 8px 0; }
        #summary-details .total { font-weight: bold; font-size: 1.1em; border-top: 1px solid #ccc; padding-top: 8px; }

    </style>
</head>
<body>

    <div class="app-shell">
        <aside class="sidebar">
            <div class="sidebar-header">WeekendMatcha</div>
            <nav class="sidebar-nav">
                <ul>
                    <li>Inventory</li>
                    <li class="active">Sales (POS)</li>
                    <li>Human Resource</li>
                </ul>
            </nav>
            <div class="sidebar-footer">&#8592; Log Out</div>
        </aside>

        <main class="main-content">
            <h1>Point of Sale System</h1>
            <div class="pos-container">
                <!-- Left Panel: Product Selection -->
                <div class="product-panel">
                    <h2>Select Products</h2>
                    <div class="product-grid" id="product-grid">
                        <!-- Products will be dynamically inserted here -->
                    </div>
                </div>
                <!-- Right Panel: Current Order -->
                <div class="order-panel">
                    <h2>Current Order</h2>
                    <div id="order-items-list">
                        <!-- Order items will be dynamically inserted here -->
                    </div>
                    <div class="order-total-section">
                        <div class="total-line">
                            <span>TOTAL</span>
                            <span id="order-total">₱0.00</span>
                        </div>
                        <button id="payment-btn" class="action-btn payment-btn" disabled>Process Payment</button>
                        <button id="clear-btn" class="action-btn clear-btn" disabled>Clear Order</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Payment Modal -->
    <div id="payment-modal" class="modal">
        <div class="modal-content">
            <h2>Process Payment</h2>
            <div class="form-group">
                <label>Total Amount Due</label>
                <input type="text" id="total-due-display" readonly style="background:#eee;">
            </div>
            <div class="form-group">
                <label for="cash-received">Cash Received</label>
                <input type="number" id="cash-received" placeholder="0.00">
            </div>
            <h3>Change Due:</h3>
            <div id="change-due">₱0.00</div>
            <div class="modal-actions">
                <button id="cancel-payment-btn" class="action-btn clear-btn" style="flex:1;">Cancel</button>
                <button id="confirm-payment-btn" class="action-btn payment-btn" style="flex:1;" disabled>Confirm</button>
            </div>
        </div>
    </div>
    
    <!-- Transaction Summary Modal -->
    <div id="summary-modal" class="modal">
        <div class="modal-content">
            <h2 style="color:var(--accent-green);">Transaction Complete!</h2>
            <p>Transaction ID: <span id="summary-tid"></span></p>
            <div id="summary-details">
                <!-- Summary details will be populated here -->
            </div>
            <button id="new-order-btn" class="action-btn payment-btn" style="width:100%;">Start New Order</button>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- MOCK DATABASE (based on Class Diagrams) ---
        const products = [
            { id: 1, name: 'Matcha Latte', price: 150.00, img: 'https://via.placeholder.com/80/A2D0C0/3e4a3e?text=ML' },
            { id: 2, name: 'Hojicha Latte', price: 150.00, img: 'https://via.placeholder.com/80/D0B8A2/3e4a3e?text=HL' },
            { id: 3, name: 'Strawberry Matcha', price: 160.00, img: 'https://via.placeholder.com/80/F2A0A0/3e4a3e?text=SM' },
            { id: 4, name: 'Taro Latte', price: 140.00, img: 'https://via.placeholder.com/80/D1C4E9/3e4a3e?text=TL' },
            { id: 5, name: 'Classic Milk Tea', price: 120.00, img: 'https://via.placeholder.com/80/EAC696/3e4a3e?text=MT' },
            { id: 6, name: 'Croissant', price: 85.00, img: 'https://via.placeholder.com/80/FFDAB9/3e4a3e?text=C' },
        ];
        let currentOrder = []; // Simulates TransactionItem table
        let recentTransactions = []; // Simulates Transaction table

        // --- DOM ELEMENT SELECTORS ---
        const productGrid = document.getElementById('product-grid');
        const orderItemsList = document.getElementById('order-items-list');
        const orderTotalDisplay = document.getElementById('order-total');
        const paymentBtn = document.getElementById('payment-btn');
        const clearBtn = document.getElementById('clear-btn');
        const paymentModal = document.getElementById('payment-modal');
        const summaryModal = document.getElementById('summary-modal');

        // --- CORE FUNCTIONS (Implementing Use Cases & Class Logic) ---

        // Function to render all products
        const renderProducts = () => {
            productGrid.innerHTML = '';
            products.forEach(product => {
                productGrid.innerHTML += `
                    <div class="product-card" data-id="${product.id}">
                        <img src="${product.img}" alt="${product.name}">
                        <div class="product-name">${product.name}</div>
                        <div class="product-price">₱${product.price.toFixed(2)}</div>
                    </div>
                `;
            });
        };

        // USE CASE: Add Items to Order
        const addItemToOrder = (productId) => {
            const product = products.find(p => p.id === productId);
            const existingItem = currentOrder.find(item => item.productId === productId);

            if (existingItem) {
                existingItem.quantity++;
            } else {
                currentOrder.push({
                    productId: product.id,
                    name: product.name,
                    priceAtSale: product.price,
                    quantity: 1
                });
            }
            renderOrder();
        };
        
        const adjustQuantity = (productId, amount) => {
            const item = currentOrder.find(i => i.productId === productId);
            if (item) {
                item.quantity += amount;
                if (item.quantity <= 0) {
                    currentOrder = currentOrder.filter(i => i.productId !== productId);
                }
            }
            renderOrder();
        };

        // Renders the current order and calculates total
        const renderOrder = () => {
            orderItemsList.innerHTML = '';
            if (currentOrder.length === 0) {
                orderItemsList.innerHTML = `<p style="text-align:center; color:#888;">No items in order.</p>`;
            }
            
            currentOrder.forEach(item => {
                const subtotal = item.priceAtSale * item.quantity; // getSubtotal() logic
                orderItemsList.innerHTML += `
                    <div class="order-item">
                        <div class="order-item-details">
                            <div class="name">${item.name}</div>
                            <div class="price">${item.quantity} x ₱${item.priceAtSale.toFixed(2)}</div>
                        </div>
                        <div class="order-item-qty">
                             <button class="qty-btn" onclick="window.adjustQuantity(${item.productId}, -1)">-</button>
                             <span>${item.quantity}</span>
                             <button class="qty-btn" onclick="window.adjustQuantity(${item.productId}, 1)">+</button>
                        </div>
                        <div class="order-item-subtotal">₱${subtotal.toFixed(2)}</div>
                    </div>
                `;
            });
            updateTotal();
        };

        // USE CASE: Calculate Total
        const updateTotal = () => {
            const total = currentOrder.reduce((sum, item) => sum + (item.priceAtSale * item.quantity), 0); // calculateTotal() logic
            orderTotalDisplay.textContent = `₱${total.toFixed(2)}`;
            paymentBtn.disabled = currentOrder.length === 0;
            clearBtn.disabled = currentOrder.length === 0;
        };

        // USE CASE: Clear Current Order
        const clearOrder = () => {
            currentOrder = [];
            renderOrder();
        };

        // USE CASE: Process Payment via Cash
        const openPaymentModal = () => {
            const total = currentOrder.reduce((sum, item) => sum + (item.priceAtSale * item.quantity), 0);
            document.getElementById('total-due-display').value = `₱${total.toFixed(2)}`;
            document.getElementById('cash-received').value = '';
            document.getElementById('change-due').textContent = '₱0.00';
            document.getElementById('confirm-payment-btn').disabled = true;
            paymentModal.style.display = 'flex';
        };

        // --- EVENT BINDINGS ---
        productGrid.addEventListener('click', e => {
            const card = e.target.closest('.product-card');
            if (card) addItemToOrder(parseInt(card.dataset.id));
        });

        paymentBtn.addEventListener('click', openPaymentModal);
        clearBtn.addEventListener('click', clearOrder);
        document.getElementById('cancel-payment-btn').addEventListener('click', () => paymentModal.style.display = 'none');
        document.getElementById('new-order-btn').addEventListener('click', () => summaryModal.style.display = 'none');
        
        // Payment modal logic
        const cashReceivedInput = document.getElementById('cash-received');
        const confirmPaymentBtn = document.getElementById('confirm-payment-btn');
        cashReceivedInput.addEventListener('input', () => {
            const totalDue = currentOrder.reduce((sum, item) => sum + (item.priceAtSale * item.quantity), 0);
            const cash = parseFloat(cashReceivedInput.value) || 0;
            const change = cash - totalDue;
            
            if (change >= 0) {
                document.getElementById('change-due').textContent = `₱${change.toFixed(2)}`;
                confirmPaymentBtn.disabled = false;
            } else {
                document.getElementById('change-due').textContent = 'Insufficient amount';
                confirmPaymentBtn.disabled = true;
            }
        });
        
        // USE CASE: Record Sale Transaction & Display Summary
        confirmPaymentBtn.addEventListener('click', () => {
            const totalAmount = currentOrder.reduce((sum, item) => sum + (item.priceAtSale * item.quantity), 0);
            const amountReceived = parseFloat(cashReceivedInput.value);
            
            const transaction = {
                transactionId: Date.now(), // Simple unique ID
                employeeId: 101, // Mock employee ID
                transactionDateTime: new Date(),
                totalAmount: totalAmount,
                amountReceived: amountReceived,
                changeGiven: amountReceived - totalAmount,
                items: [...currentOrder] // Save a copy of the items
            };
            
            recentTransactions.push(transaction); // CREATE operation
            
            // Display Summary
            document.getElementById('summary-tid').textContent = transaction.transactionId;
            const summaryDetails = document.getElementById('summary-details');
            summaryDetails.innerHTML = ''; // Clear previous summary
            transaction.items.forEach(item => {
                summaryDetails.innerHTML += `<p><span>${item.name} (x${item.quantity})</span> <span>₱${(item.priceAtSale * item.quantity).toFixed(2)}</span></p>`;
            });
            summaryDetails.innerHTML += `
                <p class="total"><span>Total</span> <span>₱${transaction.totalAmount.toFixed(2)}</span></p>
                <p><span>Cash Paid</span> <span>₱${transaction.amountReceived.toFixed(2)}</span></p>
                <p><span>Change</span> <span>₱${transaction.changeGiven.toFixed(2)}</span></p>
            `;
            
            paymentModal.style.display = 'none';
            summaryModal.style.display = 'flex';
            clearOrder();
        });

        // --- INITIALIZATION ---
        renderProducts();
        renderOrder();
        
        // Expose functions to global scope for inline onclick handlers
        window.adjustQuantity = adjustQuantity;
    });
    </script>
</body>
</html>
